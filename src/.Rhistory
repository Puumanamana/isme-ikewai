pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level') %>%
inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
bind_rows(data)
}
data <- c()
for (clade in names(taxa_to_plot)) {
mg_subset <- subset_taxa(metagenome, Genus %in% taxa_to_plot[[clade]])
abundance <- as.data.frame(otu_table(mg_subset))
colnames(abundance) <- tax_table(mg_subset)[colnames(abundance), 'Genus']
# data <- psmelt(mg_subset) %>%
#   inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
#   mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
#   bind_rows(data)
#   pivot_longer(hue_cols, names_to='Genus', values_to='abundance')
data <- abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
pivot_longer(-hue_cols, names_to='Genus', values_to='abundance') %>%
pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level') %>%
inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
bind_rows(data)
}
data <- abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
pivot_longer(-hue_cols, names_to='Genus', values_to='abundance') %>%
pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level') %>%
inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
bind_rows(data)
abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
pivot_longer(-hue_cols, names_to='Genus', values_to='abundance') %>%
pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level') %>%
inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj))
data <- c()
mg_subset <- subset_taxa(metagenome, Genus %in% taxa_to_plot[[clade]])
abundance <- as.data.frame(otu_table(mg_subset))
colnames(abundance) <- tax_table(mg_subset)[colnames(abundance), 'Genus']
data <- abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
pivot_longer(-hue_cols, names_to='Genus', values_to='abundance') %>%
pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level') %>%
inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
bind_rows(data)
#========== Filter and sort result ============#
sig_otu_table <- results(diagdds, alpha=pval, pAdjustMethod='BH',parallel=TRUE)
sig_otu_table <- sig_otu_table[order(sig_otu_table$padj, na.last=NA), ]
sig_otu_table$padj <- signif(sig_otu_table$padj, 3)
sig_otu_table <- sig_otu_table[sig_otu_table$padj<0.5,]
sig_otu_table <- cbind(
as(sig_otu_table, "data.frame"),
as(tax_table(metagenome)[rownames(sig_otu_table), ], "matrix")
)
taxa_to_plot <- list(dsrB=c('Desulfurivibrio', 'Desulfovibrio', 'Aeromonas', 'Alcanivorax',
'Hymenobacter', 'Desulfobulbus'),
nirS=c('Pseudomonas', 'Aquabacterium', 'Hydrogenophaga', 'Halomonas',
'Desulfurivibrio', 'Bradyrhizobium', 'Pseudoxanthomonas'))
data <- c()
for (clade in names(taxa_to_plot)) {
mg_subset <- subset_taxa(metagenome, Genus %in% taxa_to_plot[[clade]])
abundance <- as.data.frame(otu_table(mg_subset))
colnames(abundance) <- tax_table(mg_subset)[colnames(abundance), 'Genus']
# data <- psmelt(mg_subset) %>%
#   inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
#   mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
#   bind_rows(data)
#   pivot_longer(hue_cols, names_to='Genus', values_to='abundance')
data <- abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
pivot_longer(-hue_cols, names_to='Genus', values_to='abundance') %>%
pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level') %>%
inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
bind_rows(data)
}
ggplot(data, aes(x=Genus, y=Abundance, fill=Eruption)) +
gginit() +
geom_boxplot() +
# scale_fill_manual(values=colors$Eruption) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='abundance')
ggplot(data[data$factor=='PCA_Grp', ], aes(x=Genus, y=abundance, fill=level)) +
gginit() +
geom_boxplot() +
scale_fill_manual(values=colors$PCA_Grp) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='abundance')
data
data <- c()
mg_subset <- subset_taxa(metagenome, Genus %in% taxa_to_plot[[clade]])
abundance <- as.data.frame(otu_table(mg_subset))
mg_subset
colnames(abundance) <- tax_table(mg_subset)[colnames(abundance), 'Genus']
abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
pivot_longer(-hue_cols, names_to='Genus', values_to='abundance')
abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
pivot_longer(-hue_cols, names_to='Genus', values_to='abundance') %>%
pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level')
abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
pivot_longer(-hue_cols, names_to='Genus', values_to='abundance') %>%
pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level') %>%
inner_join(sig_otu_table[, c('Genus', 'padj')])
abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
pivot_longer(-hue_cols, names_to='Genus', values_to='abundance') %>%
pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level')
abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
pivot_longer(-hue_cols, names_to='Genus', values_to='abundance')
abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame'))
abundance%>%head
mg_subset <- subset_taxa(metagenome, Genus %in% taxa_to_plot[[clade]])
abundance <- as.data.frame(otu_table(mg_subset))
abundance%>%head
abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame'))
abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
pivot_longer(-hue_cols, names_to='Genus', values_to='abundance') %>%
pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level') %>%
inner_join(sig_otu_table[, c('Genus', 'padj')])
metagenome <- load_metagenome(abundance_file=sprintf('../data/%s/abundance.csv',  mode),
metadata_file=sprintf('../data/%s/metadata.csv', mode))
metagenome <- subset_samples(metagenome, PCA_Grp %in% c('C', 'D'))
metagenome <- speedyseq::tax_glom(metagenome, 'Genus')
metagenome <- filter_prevalence(metagenome, min_prevalence=2)
data <- c()
for (clade in names(taxa_to_plot)) {
mg_subset <- subset_taxa(metagenome, Genus %in% taxa_to_plot[[clade]])
abundance <- as.data.frame(otu_table(mg_subset))
# colnames(abundance) <- tax_table(mg_subset)[colnames(abundance), 'Genus']
# data <- psmelt(mg_subset) %>%
#   inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
#   mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
#   bind_rows(data)
#   pivot_longer(hue_cols, names_to='Genus', values_to='abundance')
data <- abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
pivot_longer(-hue_cols, names_to='Genus', values_to='abundance') %>%
pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level') %>%
inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
bind_rows(data)
}
ggplot(data[data$factor=='PCA_Grp', ], aes(x=Genus, y=abundance, fill=level)) +
gginit() +
geom_boxplot() +
scale_fill_manual(values=colors$PCA_Grp) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='abundance')
data%>% hed
data%>% head
data <- c()
for (clade in names(taxa_to_plot)) {
mg_subset <- subset_taxa(metagenome, Genus %in% taxa_to_plot[[clade]])
abundance <- as.data.frame(otu_table(mg_subset))
# colnames(abundance) <- tax_table(mg_subset)[colnames(abundance), 'Genus']
# data <- psmelt(mg_subset) %>%
#   inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
#   mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
#   bind_rows(data)
#   pivot_longer(hue_cols, names_to='Genus', values_to='abundance')
data <- abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
pivot_longer(-hue_cols, names_to='Genus', values_to='abundance') %>%
pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level') %>%
inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
bind_rows(data)
}
data%>% head
mg_subset <- subset_taxa(metagenome, Genus %in% taxa_to_plot[[clade]])
abundance <- as.data.frame(otu_table(mg_subset))
abundance %>% head
data <- c()
for (clade in names(taxa_to_plot)) {
mg_subset <- subset_taxa(metagenome, Genus %in% taxa_to_plot[[clade]])
abundance <- as.data.frame(otu_table(mg_subset))
colnames(abundance) <- tax_table(mg_subset)[colnames(abundance), 'Genus']
# data <- psmelt(mg_subset) %>%
#   inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
#   mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
#   bind_rows(data)
#   pivot_longer(hue_cols, names_to='Genus', values_to='abundance')
data <- abundance %>%
bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
pivot_longer(-hue_cols, names_to='Genus', values_to='abundance') %>%
pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level') %>%
inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
bind_rows(data)
}
ggplot(data, aes(x=Genus, y=Abundance, fill=Eruption)) +
gginit() +
geom_boxplot() +
# scale_fill_manual(values=colors$Eruption) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='abundance')
ggsave(sprintf('%s/Figure-8A distr_eruption.pdf', io['figures']), width=50, height=30, units="cm")
ggplot(data[data$factor=='PCA_Grp', ], aes(x=Genus, y=abundance, fill=level)) +
gginit() +
geom_boxplot() +
scale_fill_manual(values=colors$PCA_Grp) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='abundance')
data <- c()
for (clade in names(taxa_to_plot)) {
mg_subset <- subset_taxa(metagenome, Genus %in% taxa_to_plot[[clade]])
abundance <- as.data.frame(otu_table(mg_subset))
colnames(abundance) <- tax_table(mg_subset)[colnames(abundance), 'Genus']
data <- psmelt(mg_subset) %>%
inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
bind_rows(data)
pivot_longer(hue_cols, names_to='Genus', values_to='abundance')
# data <- abundance %>%
#   bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
#   pivot_longer(-hue_cols, names_to='Genus', values_to='abundance') %>%
#   pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level') %>%
#   inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
#   mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
#   bind_rows(data)
}
data <- c()
for (clade in names(taxa_to_plot)) {
mg_subset <- subset_taxa(metagenome, Genus %in% taxa_to_plot[[clade]])
abundance <- as.data.frame(otu_table(mg_subset))
colnames(abundance) <- tax_table(mg_subset)[colnames(abundance), 'Genus']
data <- psmelt(mg_subset) %>%
inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
bind_rows(data)
# data <- abundance %>%
#   bind_cols(as(sample_data(mg_subset)[, hue_cols], 'data.frame')) %>%
#   pivot_longer(-hue_cols, names_to='Genus', values_to='abundance') %>%
#   pivot_longer(-c('Genus', 'abundance'), names_to='factor', values_to='level') %>%
#   inner_join(sig_otu_table[, c('Genus', 'padj')]) %>%
#   mutate(clade=clade, label=sprintf('%s (%s, padj=%s)', Genus, clade, padj)) %>%
#   bind_rows(data)
}
ggplot(data, aes(x=Genus, y=Abundance, fill=Eruption)) +
gginit() +
geom_boxplot() +
# scale_fill_manual(values=colors$Eruption) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='abundance')
ggplot(data, aes(x=Genus, y=Abundance, fill=Eruption)) +
gginit() +
geom_boxplot() +
scale_fill_manual(values=colors$Eruption) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='abundance')
ggplot(data, aes(x=Genus, y=abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot() +
scale_fill_manual(values=colors$PCA_Grp) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='abundance')
data %>% head
ggplot(data, aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot() +
scale_fill_manual(values=colors$PCA_Grp) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='abundance')
ggplot(data, aes(Abundance, fill=Eruption)) +
gginit() +
geom_density() +
scale_x_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
data %>% head
ggplot(data, aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot() +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data, aes(x=YM, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot() +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data, aes(x=Eruption, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot() +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data[data$Eruption=='PreEruption'], aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot() +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data[data$Eruption=='PreEruption',], aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot() +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data[data$Eruption=='PostEruption',], aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot() +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data[data$Eruption=='PreEruption',], aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot() +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data[data$Eruption=='PreEruption',], aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot() +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
ylim(0, 10)
ggplot(data[data$Eruption=='PreEruption',], aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot() +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
ylim(0, 10) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data[data$Eruption=='PreEruption',], aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot() +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
ylim(0, 5) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data[data$Eruption=='PreEruption',], aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot() +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data[data$Eruption=='PreEruption',], aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot(outlier.shape = NA) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
# filtering function - turns outliers into NAs to be removed
filter_lims <- function(x){
l <- boxplot.stats(x)$stats[1]
u <- boxplot.stats(x)$stats[5]
for (i in 1:length(x)){
x[i] <- ifelse(x[i]>l & x[i]<u, x[i], NA)
}
return(x)
}
ggplot(data, aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot(outlier.shape = NA) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data, aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot() +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data, aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot(outlier.shape = NA) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data, aes(x=Genus, y=Abundance, fill=PCA_Grp)) +
gginit() +
geom_boxplot(outlier.shape = NA) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data, aes(x=Genus, y=Abundance, fill=Eruption)) +
gginit() +
geom_boxplot() +
scale_fill_manual(values=colors$Eruption) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
data %>%
group_by(label, Eruption) %>%  # do the same calcs for each box
mutate(abd = filter_lims(Abundance)) %>%
ggplot(aes(x=Genus, y=Abundance, fill=Eruption)) +
gginit() +
geom_boxplot() +
scale_fill_manual(values=colors$Eruption) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
data %>%
group_by(label, Eruption) %>%  # do the same calcs for each box
mutate(abd = filter_lims(Abundance)) %>%
ggplot(aes(x=Genus, y=Abundance, fill=Eruption)) +
gginit() +
geom_boxplot(na.rm = TRUE) +
scale_fill_manual(values=colors$Eruption) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
data %>%
group_by(label, Eruption) %>%  # do the same calcs for each box
mutate(abd = filter_lims(Abundance)) %>%
ggplot(aes(x=Genus, y=Abundance, fill=Eruption)) +
gginit() +
geom_boxplot(na.rm = TRUE, coef=5) +
scale_fill_manual(values=colors$Eruption) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
ggplot(data, aes(x=Genus, y=Abundance, fill=Eruption)) +
gginit() +
geom_boxplot() +
scale_fill_manual(values=colors$Eruption) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
data %>%
group_by(label, Eruption) %>%  # do the same calcs for each box
mutate(abd = filter_lims(Abundance)) %>%
ggplot(aes(x=Genus, y=Abundance, fill=Eruption)) +
gginit() +
geom_boxplot(na.rm = TRUE, coef=5) +
scale_fill_manual(values=colors$Eruption) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
data %>%
group_by(label, Eruption) %>%  # do the same calcs for each box
mutate(abd = filter_lims(Abundance)) %>%
ggplot(aes(x=Genus, y=abd, fill=Eruption)) +
gginit() +
geom_boxplot(na.rm = TRUE, coef=5) +
scale_fill_manual(values=colors$Eruption) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
# filtering function - turns outliers into NAs to be removed
filter_lims <- function(x){
l <- boxplot.stats(x)$stats[1]
u <- boxplot.stats(x)$stats[5]
for (i in 1:length(x)){
x[i] <- ifelse(x[i]>=l & x[i]<=u, x[i], NA)
}
return(x)
}
data %>%
group_by(label, Eruption) %>%  # do the same calcs for each box
mutate(abd = filter_lims(Abundance)) %>%
ggplot(aes(x=Genus, y=abd, fill=Eruption)) +
gginit() +
geom_boxplot(na.rm = TRUE, coef=5) +
scale_fill_manual(values=colors$Eruption) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
# filtering function - turns outliers into NAs to be removed
filter_lims <- function(x){
l <- boxplot.stats(x)$stats[1]
u <- boxplot.stats(x)$stats[5]
for (i in 1:length(x)){
x[i] <- ifelse(x[i]>=l & x[i]<u, x[i], NA)
}
return(x)
}
data %>%
group_by(label, Eruption) %>%  # do the same calcs for each box
mutate(abd = filter_lims(Abundance)) %>%
ggplot(aes(x=Genus, y=abd, fill=Eruption)) +
gginit() +
geom_boxplot(na.rm = TRUE, coef=5) +
scale_fill_manual(values=colors$Eruption) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
# filtering function - turns outliers into NAs to be removed
filter_lims <- function(x){
l <- boxplot.stats(x)$stats[1]
u <- boxplot.stats(x)$stats[5]
for (i in 1:length(x)){
x[i] <- ifelse(x[i]>l & x[i]<u, x[i], NA)
}
return(x)
}
ggplot(data, aes(x=Genus, y=Abundance, fill=Eruption)) +
gginit() +
geom_boxplot() +
scale_fill_manual(values=colors$Eruption) +
scale_y_continuous(trans=scales::pseudo_log_trans(base=10)) +
facet_wrap(' ~ label', scale="free") +
labs(x='', y='Abundance')
